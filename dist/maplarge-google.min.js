!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.maplarge=t()}}(function(){return function(){function t(e,r,n){function i(s,a){if(!r[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var f=r[s]={exports:{}};e[s][0].call(f.exports,function(t){return i(e[s][1][t]||t)},f,f.exports,t,e,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}return t}()({1:[function(t,e,r){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t){if(c.has(t))return c.get(t);var e=(0,f.default)(t).toString("hex");return c.set(t,e),e}function o(t){return i(s(t))}function s(t){if(l.has(t))return l.get(t);var e=a(t);return l.set(t,e),e}function a(t){switch(n(t)){case"boolean":case"number":case"string":return JSON.stringify(t);case"undefined":return"null";case"object":if(!t)return"null";if(Array.isArray(t))return"["+t.map(s).join(",")+"]";if(t instanceof Date)return JSON.stringify(t);var e=Object.keys(t);return e.length?e.sort().reduce(function(e,r){return"undefined"===r?e:(null===e?e='{"':e+=',"',e+=r,e+='":',e+=s(t[r]))},null)+"}":"{}";case"function":return h(t);default:throw new Error("unknown type "+n(t))}}function u(t){var e=t.indexOf("//");return-1===e?t.trim():t.slice(0,e).trim()}function h(t){return t.toString().replace(/[\r\t]/g," ").split("\n").map(u).join("")}Object.defineProperty(r,"__esModule",{value:!0}),r.makeMD5=i,r.default=o,r.stringify=s;var f=function(t){return t&&t.__esModule?t:{default:t}}(t("create-hash/md5")),c=new Map,l=new Map},{"create-hash/md5":12}],2:[function(t,e,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=t.google;r.default=n,e.exports=r.default}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(t,e,r){"use strict";function n(t,e){return s(t)||o(t,e)||i()}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function o(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(i)throw o}}return r}function s(t){if(Array.isArray(t))return t}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function h(t,e,r){return e&&u(t.prototype,e),r&&u(t,r),t}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var f=function(t){return t&&t.__esModule?t:{default:t}}(t("./google")),c=function(){function t(e){a(this,t),this.minZoom=e.minZoom,this.maxZoom=e.maxZoom,this.name=e.name,this.tileSize=new f.default.maps.Size(256,256),this._zindex=e._zindex,this.parent=e,this.divs=[]}return h(t,[{key:"getTileUrl",value:function(){return"https://maps.gstatic.com/mapfiles/transparent.png"}},{key:"destroy",value:function(){var t=!0,e=!1,r=void 0;try{for(var i,o=this.parent.divCache[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=n(i.value,1),a=s[0];this.releaseTile(a)}}catch(t){e=!0,r=t}finally{try{t||null==o.return||o.return()}finally{if(e)throw r}}this.divs=[]}},{key:"releaseTile",value:function(t){this.parent.divCache.delete(t),this.parent.waitingImages.delete(t),t.firstChild&&(t.firstChild.style.visibility="hidden"),this.divs.push(t)}},{key:"getTile",value:function(t,e,r){var n,i=this;return n=this.divs.length?this.divs.pop():r.createElement("div"),n.style.width="256px",n.style.height="256px",this.parent.divCache.set(n,{coord:t,zoom:e}),this.parent.getTileUrl(e,t.x,t.y).then(function(r){i.parent.replaceImg(r,n)&&i.parent.utfGrid&&i.parent.utfGrid._loadTile(e,t.x,t.y)}),n}}]),t}(),l=c;r.default=l,e.exports=r.default},{"./google":2}],4:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e,r){return e&&s(t.prototype,e),r&&s(t,r),t}function u(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?h(t):e}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var p=n(t("events")),d=n(t("zoku")),v=function(t){function e(t,r){var n;return o(this,e),n=u(this,f(e).call(this)),n.url="https://"+t.host+"/Remote/GetActiveTableID",n.opts={shortTableId:t.account+"/"+t.table},n.table=void 0,r=r||30,n.interval=1e3*r,n.timeout=void 0,n.aborted=!1,n.checkTable(),n}return c(e,t),a(e,[{key:"checkTable",value:function(){var t=this;return(0,d.default)(this.url,this.opts).then(function(e){if(t.aborted)return!1;if(!e)throw new Error("no response");if(Array.isArray(e.errors)&&e.errors.length)throw new Error(e.errors.join());if(!e.success||!e.table)throw new Error("invalid response");return e.table}).then(function(e){if(!t.aborted){var r=t.table;t.table!==e&&(t.table=e,r||t.emit("ready"),t.emit("change",e)),t.timeout=setTimeout(function(){t.timeout=void 0,t.aborted||t.checkTable()},t.interval)}}).catch(function(e){t.timeout&&clearTimeout(t.timeout),t.emit("error",e)})}},{key:"abort",value:function(){this.aborted=!0,this.timeout&&clearTimeout(this.timeout),this.removeAllListeners()}}]),e}(p.default.EventEmitter);r.default=v,e.exports=r.default},{events:13,zoku:23}],5:[function(t,e,r){"use strict";function n(t,e){if(!e)return null;for(var r=e[2].split("`~!"),n={},i=-1,o=t.length;++i<o;)n[t[i]]=r[i];return n}Object.defineProperty(r,"__esModule",{value:!0}),r.default=n,e.exports=r.default},{}],6:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=function(t,e){if("https://maps.gstatic.com/mapfiles/transparent.png"!==t){var r=e.firstChild;if(!r||r.src!==t){var n=document.createElement("img");n.src=t,n.alt="",r?e.replaceChild(n,r):e.appendChild(n)}}else for(;e.firstChild;)e.removeChild(e.firstChild)};r.default=n,e.exports=r.default},{}],7:[function(t,e,r){"use strict";function n(t){var e=[],r=[];t.overlayMapTypes.forEach(function(t,n){t&&"number"==typeof t._zindex&&(e.push({item:t,cur:n}),r.push(n))}),e.length<=1||(e.sort(function(t,e){return t.item._zindex-e.item._zindex}),e.forEach(function(t,e){t.next=r[e]}),e.filter(function(t){return t.cur!==t.next}).forEach(function(e){t.overlayMapTypes.setAt(e.next,e.item)}))}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n;r.default=i,e.exports=r.default},{}],8:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?a(t):e}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function l(t,e,r){return e&&c(t.prototype,e),r&&c(t,r),t}function p(t,e,r,n){var i=w.get(t);return i||(i=new _(t),w.set(t,i)),i.setEvent(e,r,n)}function d(t,e){var r=w.get(t);r&&r.removeEvent(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var v=n(t("./google")),y=n(t("zoku")),m=n(t("querystring")),g=function(t,e){return!(!e||!t)&&(t[0]===e[0]&&(t[1]===e[1]&&t[2]===e[2]))},w=new WeakMap,_=function(){function t(e){f(this,t),this.map=e,this.events=new Map,this._listeners=new Map}return l(t,[{key:"setEvent",value:function(t,e,r){var n=this;if(!this.events.has(t)){this.events.set(t,[]);var i=this.map.addListener(t,function(e){var r=n.events.get(t),i=!0,o=!1,s=void 0;try{for(var a,u=r[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var h=a.value;h.cb.call(h.ctx,e)}}catch(t){o=!0,s=t}finally{try{i||null==u.return||u.return()}finally{if(o)throw s}}},this);this._listeners.set(t,i)}var o={eventName:t},s={cb:e,ctx:r,symbol:o},a=this.events.get(t);a.push(s),a.sort(function(t,e){var r=t.ctx.zindex,n=e.ctx.zindex;return r===n?0:r<n?1:-1}),this.events.set(t,a);var u={};return w.set(u,o),u}},{key:"removeEvent",value:function(t){var e=w.get(t);if(e.eventName&&this.events.has(e.eventName)&&this._listeners.has(e.eventName)){var r=this.events.get(e.eventName);if(r=r.filter(function(t){return t.symbol!==e}),r.length)return void this.events.set(e.eventName,r);this.events.delete(e.eventName);var n=this._listeners.get(e.eventName);this._listeners.delete(e.eventName),v.default.maps.event.removeListener(n)}}}]),t}(),b=function(t){function e(t,r){var n;f(this,e),n=o(this,s(e).call(this)),r=r||{},n.options={subdomains:"012",minZoom:r.minZoom||0,maxZoom:r.maxZoom||20,tileSize:256,pointerCursor:!0},n.zindex=r.zindex||-1/0,n.options.gridWidth=n.options.tileSize>>2,n._mouseOn=null,n._url=t,n._cache=new Map,n._reqCache=new Map,n._inProgres=new Set,n._attached=!1,n._events=[];for(var i=0;window["lu"+i];)i++;n._windowKey="lu"+i,window[n._windowKey]={},n.draw=function(){};var u=[],h=a(n);return n.on=function(t,e){var r=v.default.maps.event.addListener(h,t,e);u.push(r)},n.off=function(){for(;u.length;)v.default.maps.event.removeListener(u.pop())},n}return u(e,t),l(e,[{key:"onAdd",value:function(){var t=this,e=this.getMap();this._map=e,this._container=e.getDiv(),this._zoomEvent=e.addListener("zoom_changed",function(e){return t.zoomChanged(e)},this),this.zoomChanged()}},{key:"zoomChanged",value:function(){var t=this,e=this._map.getZoom();if(e>this.options.maxZoom||e<this.options.minZoom)return this._removeHandlers();this._attached||(this._attached=!0,this._events=[p(this._map,"mousemove",function(e){return t._move(e)},this),p(this._map,"click",function(e){return t._click(e)},this)])}},{key:"_removeHandlers",value:function(t){var e=this;t&&this._zoomEvent&&(v.default.maps.event.removeListener(this._zoomEvent),this._zoomEvent=null,this.off()),this._attached&&(this._attached=!1,this._events.forEach(function(t){return d(e._map,t)}),this._events=[])}},{key:"onRemove",value:function(){this._removeHandlers(!0),this.options.pointerCursor&&(this._container.style.cursor=""),this._cache.clear()}},{key:"_click",value:function(t){this._move(t),this._mouseOn&&v.default.maps.event.trigger(this,"click",{latLng:t.latLng,data:this._mouseOn})}},{key:"_move",value:function(t){var e=this._objectForEvent(t),r=this._map;g(e.data,this._mouseOn)?e.data&&(v.default.maps.event.trigger(this,"mouseover",e),r.setOptions({draggableCursor:"pointer"})):(this._mouseOn&&(v.default.maps.event.trigger(this,"mouseout",{latLng:t.latLng,data:this._mouseOn}),r.setOptions({draggableCursor:"url(//maps.google.com/mapfiles/openhand.cur), move"})),e.data&&(v.default.maps.event.trigger(this,"mouseover",e),r.setOptions({draggableCursor:"pointer"})),this._mouseOn=e.data)}},{key:"reset",value:function(){this._cache.clear()}},{key:"_objectForEvent",value:function(t){var e=this._map,r=this.options.tileSize,n=this._getPixelCoordinates(t.latLng),i=Math.floor(n.x/r),o=Math.floor(n.y/r),s=n.x-i*r>>2,a=n.y-o*r>>2,u=this._cache.get(e.getZoom()+"_"+i+"_"+o);if(!u||!u.data||!u.success)return{latLng:t.latLng,data:null};var h=this._decodeTile(s,a,u);return{latLng:t.latLng,data:h}}},{key:"_getPixelCoordinates",value:function(t){var e=1<<this._map.getZoom(),r=this._map.getProjection(),n=r.fromLatLngToPoint(t);return new v.default.maps.Point(n.x*e,n.y*e)}},{key:"_getTileCoordinates",value:function(t){var e=this.options.tileSize,r=this._getPixelCoordinates(t);return new v.default.maps.Point(Math.floor(r.x/e),Math.floor(r.y/e))}},{key:"_loadTile",value:function(t,e,r){var n=this,i="".concat(t,"_").concat(e,"_").concat(r);if(!this._cache.has(i)&&!this._inProgres.has(i)){this._inProgres.add(i);var o=this.normalizeCoordinate(e,t),s=this.normalizeCoordinate(r,t),a=Math.floor(t);this._url(a,o,s).then(function(t){if(t){var e=t[0]+"?"+m.default.stringify(t[1]);return n._reqCache.has(e)?n._reqCache.get(e):(0,y.default)(e).then(function(t){return n._reqCache.set(e,t),t})}}).then(function(t){n._cache.set(i,t),n._inProgres.delete(i)})}}},{key:"_decodeTile",value:function(t,e,r){if(!Object.keys(r.data.data).length)return null;var n=r.data.index.length,i=e*this.options.gridWidth+t,o=r.data.index[i];if(-1!==o){var s=r.data.data[o];if(s)return s}for(var a=[1,this.options.gridWidth,-1,-1,-this.options.gridWidth,-this.options.gridWidth,1,1],u=0,h=a;u<h.length;u++){if(!((i+=h[u])>n)&&-1!==r.data.index[i]){var f=r.data.data[r.data.index[i]];if(f)return f}}return null}},{key:"normalizeCoordinate",value:function(t,e){var r=Math.sqrt(Math.pow(4,e));if(e>0)for(;t>r||t<0;)t>r?t-=r:t<0&&(t+=r);return t}}]),e}(v.default.maps.OverlayView);r.default=b,e.exports=r.default},{"./google":2,querystring:20,zoku:23}],9:[function(t,e,r){!function(t){"use strict";function e(t){var e=t.charCodeAt(0);return e===o||e===f?62:e===s||e===c?63:e<a?-1:e<a+10?e-a+26+26:e<h+26?e-h:e<u+26?e-u+26:void 0}function r(t){function r(t){h[c++]=t}var n,o,s,a,u,h;if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var f=t.length;u="="===t.charAt(f-2)?2:"="===t.charAt(f-1)?1:0,h=new i(3*t.length/4-u),s=u>0?t.length-4:t.length;var c=0;for(n=0,o=0;n<s;n+=4,o+=3)a=e(t.charAt(n))<<18|e(t.charAt(n+1))<<12|e(t.charAt(n+2))<<6|e(t.charAt(n+3)),r((16711680&a)>>16),r((65280&a)>>8),r(255&a);return 2===u?(a=e(t.charAt(n))<<2|e(t.charAt(n+1))>>4,r(255&a)):1===u&&(a=e(t.charAt(n))<<10|e(t.charAt(n+1))<<4|e(t.charAt(n+2))>>2,r(a>>8&255),r(255&a)),h}function n(t){function e(t){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t)}var r,n,i,o=t.length%3,s="";for(r=0,i=t.length-o;r<i;r+=3)n=(t[r]<<16)+(t[r+1]<<8)+t[r+2],s+=function(t){return e(t>>18&63)+e(t>>12&63)+e(t>>6&63)+e(63&t)}(n);switch(o){case 1:n=t[t.length-1],s+=e(n>>2),s+=e(n<<4&63),s+="==";break;case 2:n=(t[t.length-2]<<8)+t[t.length-1],s+=e(n>>10),s+=e(n>>4&63),s+=e(n<<2&63),s+="="}return s}var i="undefined"!=typeof Uint8Array?Uint8Array:Array,o="+".charCodeAt(0),s="/".charCodeAt(0),a="0".charCodeAt(0),u="a".charCodeAt(0),h="A".charCodeAt(0),f="-".charCodeAt(0),c="_".charCodeAt(0);t.toByteArray=r,t.fromByteArray=n}(void 0===r?this.base64js={}:r)},{}],10:[function(t,e,r){(function(e,n){"use strict";function i(){return n.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function n(t){return this instanceof n?(n.TYPED_ARRAY_SUPPORT||(this.length=0,this.parent=void 0),"number"==typeof t?o(this,t):"string"==typeof t?s(this,t,arguments.length>1?arguments[1]:"utf8"):a(this,t)):arguments.length>1?new n(t,arguments[1]):new n(t)}function o(t,e){if(t=d(t,e<0?0:0|v(e)),!n.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;r++)t[r]=0;return t}function s(t,e,r){return"string"==typeof r&&""!==r||(r="utf8"),t=d(t,0|m(e,r)),t.write(e,r),t}function a(t,e){if(n.isBuffer(e))return u(t,e);if(J(e))return h(t,e);if(null==e)throw new TypeError("must start with number, buffer, array or string");if("undefined"!=typeof ArrayBuffer){if(e.buffer instanceof ArrayBuffer)return f(t,e);if(e instanceof ArrayBuffer)return c(t,e)}return e.length?l(t,e):p(t,e)}function u(t,e){var r=0|v(e.length);return t=d(t,r),e.copy(t,0,0,r),t}function h(t,e){var r=0|v(e.length);t=d(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function f(t,e){var r=0|v(e.length);t=d(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function c(t,e){return n.TYPED_ARRAY_SUPPORT?(e.byteLength,t=n._augment(new Uint8Array(e))):t=f(t,new Uint8Array(e)),t}function l(t,e){var r=0|v(e.length);t=d(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function p(t,e){var r,n=0;"Buffer"===e.type&&J(e.data)&&(r=e.data,n=0|v(r.length)),t=d(t,n);for(var i=0;i<n;i+=1)t[i]=255&r[i];return t}function d(t,e){return n.TYPED_ARRAY_SUPPORT?(t=n._augment(new Uint8Array(e)),t.__proto__=n.prototype):(t.length=e,t._isBuffer=!0),0!==e&&e<=n.poolSize>>>1&&(t.parent=Q),t}function v(t){if(t>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|t}function y(t,e){if(!(this instanceof y))return new y(t,e);var r=new n(t,e);return delete r.parent,r}function m(t,e){"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"binary":case"raw":case"raws":return r;case"utf8":case"utf-8":return N(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return G(t).length;default:if(n)return N(t).length;e=(""+e).toLowerCase(),n=!0}}function g(t,e,r){var n=!1;if(e|=0,r=void 0===r||r===1/0?this.length:0|r,t||(t="utf8"),e<0&&(e=0),r>this.length&&(r=this.length),r<=e)return"";for(;;)switch(t){case"hex":return O(this,e,r);case"utf8":case"utf-8":return P(this,e,r);case"ascii":return T(this,e,r);case"binary":return I(this,e,r);case"base64":return L(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function w(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=e.length;if(o%2!=0)throw new Error("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;s++){var a=parseInt(e.substr(2*s,2),16);if(isNaN(a))throw new Error("Invalid hex string");t[r+s]=a}return s}function _(t,e,r,n){return H(N(e,t.length-r),t,r,n)}function b(t,e,r,n){return H(F(e),t,r,n)}function E(t,e,r,n){return b(t,e,r,n)}function A(t,e,r,n){return H(G(e),t,r,n)}function x(t,e,r,n){return H(Z(e,t.length-r),t,r,n)}function L(t,e,r){return 0===e&&r===t.length?K.fromByteArray(t):K.fromByteArray(t.slice(e,r))}function P(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var o=t[i],s=null,a=o>239?4:o>223?3:o>191?2:1;if(i+a<=r){var u,h,f,c;switch(a){case 1:o<128&&(s=o);break;case 2:u=t[i+1],128==(192&u)&&(c=(31&o)<<6|63&u)>127&&(s=c);break;case 3:u=t[i+1],h=t[i+2],128==(192&u)&&128==(192&h)&&(c=(15&o)<<12|(63&u)<<6|63&h)>2047&&(c<55296||c>57343)&&(s=c);break;case 4:u=t[i+1],h=t[i+2],f=t[i+3],128==(192&u)&&128==(192&h)&&128==(192&f)&&(c=(15&o)<<18|(63&u)<<12|(63&h)<<6|63&f)>65535&&c<1114112&&(s=c)}}null===s?(s=65533,a=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),i+=a}return M(n)}function M(t){var e=t.length;if(e<=X)return String.fromCharCode.apply(String,t);for(var r="",n=0;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=X));return r}function T(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;i++)n+=String.fromCharCode(127&t[i]);return n}function I(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;i++)n+=String.fromCharCode(t[i]);return n}function O(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=e;o<r;o++)i+=D(t[o]);return i}function R(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function C(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function S(t,e,r,i,o,s){if(!n.isBuffer(t))throw new TypeError("buffer must be a Buffer instance");if(e>o||e<s)throw new RangeError("value is out of bounds");if(r+i>t.length)throw new RangeError("index out of range")}function k(t,e,r,n){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-r,2);i<o;i++)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function U(t,e,r,n){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-r,4);i<o;i++)t[r+i]=e>>>8*(n?i:3-i)&255}function B(t,e,r,n,i,o){if(e>i||e<o)throw new RangeError("value is out of bounds");if(r+n>t.length)throw new RangeError("index out of range");if(r<0)throw new RangeError("index out of range")}function j(t,e,r,n,i){return i||B(t,e,r,4,3.4028234663852886e38,-3.4028234663852886e38),W.write(t,e,r,n,23,4),r+4}function z(t,e,r,n,i){return i||B(t,e,r,8,1.7976931348623157e308,-1.7976931348623157e308),W.write(t,e,r,n,52,8),r+8}function Y(t){if(t=q(t).replace($,""),t.length<2)return"";for(;t.length%4!=0;)t+="=";return t}function q(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function D(t){return t<16?"0"+t.toString(16):t.toString(16)}function N(t,e){e=e||1/0;for(var r,n=t.length,i=null,o=[],s=0;s<n;s++){if((r=t.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function F(t){for(var e=[],r=0;r<t.length;r++)e.push(255&t.charCodeAt(r));return e}function Z(t,e){for(var r,n,i,o=[],s=0;s<t.length&&!((e-=2)<0);s++)r=t.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n);return o}function G(t){return K.toByteArray(Y(t))}function H(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);i++)e[i+r]=t[i];return i}var K=t("base64-js"),W=t("ieee754"),J=t("isarray");r.Buffer=n,r.SlowBuffer=y,r.INSPECT_MAX_BYTES=50,n.poolSize=8192;var Q={};n.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){function t(){}try{var e=new Uint8Array(1);return e.foo=function(){return 42},e.constructor=t,42===e.foo()&&e.constructor===t&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return!1}}(),n.TYPED_ARRAY_SUPPORT?(n.prototype.__proto__=Uint8Array.prototype,n.__proto__=Uint8Array):(n.prototype.length=void 0,n.prototype.parent=void 0),n.isBuffer=function(t){return!(null==t||!t._isBuffer)},n.compare=function(t,e){if(!n.isBuffer(t)||!n.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,i=e.length,o=0,s=Math.min(r,i);o<s&&t[o]===e[o];)++o;return o!==s&&(r=t[o],i=e[o]),r<i?-1:i<r?1:0},n.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},n.concat=function(t,e){if(!J(t))throw new TypeError("list argument must be an Array of Buffers.");if(0===t.length)return new n(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;r++)e+=t[r].length;var i=new n(e),o=0;for(r=0;r<t.length;r++){var s=t[r];s.copy(i,o),o+=s.length}return i},n.byteLength=m,n.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?P(this,0,t):g.apply(this,arguments)},n.prototype.equals=function(t){if(!n.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===n.compare(this,t)},n.prototype.inspect=function(){var t="",e=r.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},n.prototype.compare=function(t){if(!n.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?0:n.compare(this,t)},n.prototype.indexOf=function(t,e){function r(t,e,r){for(var n=-1,i=0;r+i<t.length;i++)if(t[r+i]===e[-1===n?0:i-n]){if(-1===n&&(n=i),i-n+1===e.length)return r+n}else n=-1;return-1}if(e>2147483647?e=2147483647:e<-2147483648&&(e=-2147483648),e>>=0,0===this.length)return-1;if(e>=this.length)return-1;if(e<0&&(e=Math.max(this.length+e,0)),"string"==typeof t)return 0===t.length?-1:String.prototype.indexOf.call(this,t,e);if(n.isBuffer(t))return r(this,t,e);if("number"==typeof t)return n.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,t,e):r(this,[t],e);throw new TypeError("val must be string, number or Buffer")},n.prototype.get=function(t){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(t)},n.prototype.set=function(t,e){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(t,e)},n.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else if(isFinite(e))e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else{var i=n;n=e,e=0|r,r=i}var o=this.length-e;if((void 0===r||r>o)&&(r=o),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("attempt to write outside buffer bounds");n||(n="utf8");for(var s=!1;;)switch(n){case"hex":return w(this,t,e,r);case"utf8":case"utf-8":return _(this,t,e,r);case"ascii":return b(this,t,e,r);case"binary":return E(this,t,e,r);case"base64":return A(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,t,e,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},n.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var X=4096;n.prototype.slice=function(t,e){var r=this.length;t=~~t,e=void 0===e?r:~~e,t<0?(t+=r)<0&&(t=0):t>r&&(t=r),e<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);var i;if(n.TYPED_ARRAY_SUPPORT)i=n._augment(this.subarray(t,e));else{var o=e-t;i=new n(o,void 0);for(var s=0;s<o;s++)i[s]=this[s+t]}return i.length&&(i.parent=this.parent||this),i},n.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||C(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n},n.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||C(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},n.prototype.readUInt8=function(t,e){return e||C(t,1,this.length),this[t]},n.prototype.readUInt16LE=function(t,e){return e||C(t,2,this.length),this[t]|this[t+1]<<8},n.prototype.readUInt16BE=function(t,e){return e||C(t,2,this.length),this[t]<<8|this[t+1]},n.prototype.readUInt32LE=function(t,e){return e||C(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},n.prototype.readUInt32BE=function(t,e){return e||C(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},n.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||C(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*e)),n},n.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||C(t,e,this.length);for(var n=e,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*e)),o},n.prototype.readInt8=function(t,e){return e||C(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},n.prototype.readInt16LE=function(t,e){e||C(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},n.prototype.readInt16BE=function(t,e){e||C(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},n.prototype.readInt32LE=function(t,e){return e||C(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},n.prototype.readInt32BE=function(t,e){return e||C(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},n.prototype.readFloatLE=function(t,e){return e||C(t,4,this.length),W.read(this,t,!0,23,4)},n.prototype.readFloatBE=function(t,e){return e||C(t,4,this.length),W.read(this,t,!1,23,4)},n.prototype.readDoubleLE=function(t,e){return e||C(t,8,this.length),W.read(this,t,!0,52,8)},n.prototype.readDoubleBE=function(t,e){return e||C(t,8,this.length),W.read(this,t,!1,52,8)},n.prototype.writeUIntLE=function(t,e,r,n){t=+t,e|=0,r|=0,n||S(this,t,e,r,Math.pow(2,8*r),0);var i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},n.prototype.writeUIntBE=function(t,e,r,n){t=+t,e|=0,r|=0,n||S(this,t,e,r,Math.pow(2,8*r),0);var i=r-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+r},n.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||S(this,t,e,1,255,0),n.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},n.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||S(this,t,e,2,65535,0),n.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):k(this,t,e,!0),e+2},n.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||S(this,t,e,2,65535,0),n.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):k(this,t,e,!1),e+2},n.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||S(this,t,e,4,4294967295,0),n.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):U(this,t,e,!0),e+4},n.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||S(this,t,e,4,4294967295,0),n.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):U(this,t,e,!1),e+4},n.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);S(this,t,e,r,i-1,-i)}var o=0,s=1,a=t<0?1:0;for(this[e]=255&t;++o<r&&(s*=256);)this[e+o]=(t/s>>0)-a&255;return e+r},n.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);S(this,t,e,r,i-1,-i)}var o=r-1,s=1,a=t<0?1:0;for(this[e+o]=255&t;--o>=0&&(s*=256);)this[e+o]=(t/s>>0)-a&255;return e+r},n.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||S(this,t,e,1,127,-128),n.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},n.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||S(this,t,e,2,32767,-32768),n.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):k(this,t,e,!0),e+2},n.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||S(this,t,e,2,32767,-32768),n.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):k(this,t,e,!1),e+2},n.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||S(this,t,e,4,2147483647,-2147483648),n.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):U(this,t,e,!0),e+4},n.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||S(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),n.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):U(this,t,e,!1),e+4},n.prototype.writeFloatLE=function(t,e,r){return j(this,t,e,!0,r)},n.prototype.writeFloatBE=function(t,e,r){return j(this,t,e,!1,r)},
n.prototype.writeDoubleLE=function(t,e,r){return z(this,t,e,!0,r)},n.prototype.writeDoubleBE=function(t,e,r){return z(this,t,e,!1,r)},n.prototype.copy=function(t,e,r,i){if(r||(r=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<r&&(i=r),i===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-r&&(i=t.length-e+r);var o,s=i-r;if(this===t&&r<e&&e<i)for(o=s-1;o>=0;o--)t[o+e]=this[o+r];else if(s<1e3||!n.TYPED_ARRAY_SUPPORT)for(o=0;o<s;o++)t[o+e]=this[o+r];else t._set(this.subarray(r,r+s),e);return s},n.prototype.fill=function(t,e,r){if(t||(t=0),e||(e=0),r||(r=this.length),r<e)throw new RangeError("end < start");if(r!==e&&0!==this.length){if(e<0||e>=this.length)throw new RangeError("start out of bounds");if(r<0||r>this.length)throw new RangeError("end out of bounds");var n;if("number"==typeof t)for(n=e;n<r;n++)this[n]=t;else{var i=N(t.toString()),o=i.length;for(n=e;n<r;n++)this[n]=i[n%o]}return this}},n.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(n.TYPED_ARRAY_SUPPORT)return new n(this).buffer;for(var t=new Uint8Array(this.length),e=0,r=t.length;e<r;e+=1)t[e]=this[e];return t.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var V=n.prototype;n._augment=function(t){return t.constructor=n,t._isBuffer=!0,t._set=t.set,t.get=V.get,t.set=V.set,t.write=V.write,t.toString=V.toString,t.toLocaleString=V.toString,t.toJSON=V.toJSON,t.equals=V.equals,t.compare=V.compare,t.indexOf=V.indexOf,t.copy=V.copy,t.slice=V.slice,t.readUIntLE=V.readUIntLE,t.readUIntBE=V.readUIntBE,t.readUInt8=V.readUInt8,t.readUInt16LE=V.readUInt16LE,t.readUInt16BE=V.readUInt16BE,t.readUInt32LE=V.readUInt32LE,t.readUInt32BE=V.readUInt32BE,t.readIntLE=V.readIntLE,t.readIntBE=V.readIntBE,t.readInt8=V.readInt8,t.readInt16LE=V.readInt16LE,t.readInt16BE=V.readInt16BE,t.readInt32LE=V.readInt32LE,t.readInt32BE=V.readInt32BE,t.readFloatLE=V.readFloatLE,t.readFloatBE=V.readFloatBE,t.readDoubleLE=V.readDoubleLE,t.readDoubleBE=V.readDoubleBE,t.writeUInt8=V.writeUInt8,t.writeUIntLE=V.writeUIntLE,t.writeUIntBE=V.writeUIntBE,t.writeUInt16LE=V.writeUInt16LE,t.writeUInt16BE=V.writeUInt16BE,t.writeUInt32LE=V.writeUInt32LE,t.writeUInt32BE=V.writeUInt32BE,t.writeIntLE=V.writeIntLE,t.writeIntBE=V.writeIntBE,t.writeInt8=V.writeInt8,t.writeInt16LE=V.writeInt16LE,t.writeInt16BE=V.writeInt16BE,t.writeInt32LE=V.writeInt32LE,t.writeInt32BE=V.writeInt32BE,t.writeFloatLE=V.writeFloatLE,t.writeFloatBE=V.writeFloatBE,t.writeDoubleLE=V.writeDoubleLE,t.writeDoubleBE=V.writeDoubleBE,t.fill=V.fill,t.inspect=V.inspect,t.toArrayBuffer=V.toArrayBuffer,t};var $=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer)},{"base64-js":9,buffer:10,ieee754:14,isarray:16}],11:[function(t,e,r){(function(t){"use strict";function e(e,r){if(e.length%o!=0){var n=e.length+(o-e.length%o);e=t.concat([e,s],n)}for(var i=[],a=r?e.readInt32BE:e.readInt32LE,u=0;u<e.length;u+=o)i.push(a.call(e,u));return i}function n(e,r,n){for(var i=new t(r),o=n?i.writeInt32BE:i.writeInt32LE,s=0;s<e.length;s++)o.call(i,e[s],4*s,!0);return i}function i(r,i,o,s){return t.isBuffer(r)||(r=new t(r)),n(i(e(r,s),r.length*a),o,s)}var o=4,s=new t(o);s.fill(0);var a=8;r.hash=i}).call(this,t("buffer").Buffer)},{buffer:10}],12:[function(t,e,r){"use strict";function n(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;for(var r=1732584193,n=-271733879,i=-1732584194,f=271733878,c=0;c<t.length;c+=16){var l=r,p=n,d=i,v=f;r=o(r,n,i,f,t[c+0],7,-680876936),f=o(f,r,n,i,t[c+1],12,-389564586),i=o(i,f,r,n,t[c+2],17,606105819),n=o(n,i,f,r,t[c+3],22,-1044525330),r=o(r,n,i,f,t[c+4],7,-176418897),f=o(f,r,n,i,t[c+5],12,1200080426),i=o(i,f,r,n,t[c+6],17,-1473231341),n=o(n,i,f,r,t[c+7],22,-45705983),r=o(r,n,i,f,t[c+8],7,1770035416),f=o(f,r,n,i,t[c+9],12,-1958414417),i=o(i,f,r,n,t[c+10],17,-42063),n=o(n,i,f,r,t[c+11],22,-1990404162),r=o(r,n,i,f,t[c+12],7,1804603682),f=o(f,r,n,i,t[c+13],12,-40341101),i=o(i,f,r,n,t[c+14],17,-1502002290),n=o(n,i,f,r,t[c+15],22,1236535329),r=s(r,n,i,f,t[c+1],5,-165796510),f=s(f,r,n,i,t[c+6],9,-1069501632),i=s(i,f,r,n,t[c+11],14,643717713),n=s(n,i,f,r,t[c+0],20,-373897302),r=s(r,n,i,f,t[c+5],5,-701558691),f=s(f,r,n,i,t[c+10],9,38016083),i=s(i,f,r,n,t[c+15],14,-660478335),n=s(n,i,f,r,t[c+4],20,-405537848),r=s(r,n,i,f,t[c+9],5,568446438),f=s(f,r,n,i,t[c+14],9,-1019803690),i=s(i,f,r,n,t[c+3],14,-187363961),n=s(n,i,f,r,t[c+8],20,1163531501),r=s(r,n,i,f,t[c+13],5,-1444681467),f=s(f,r,n,i,t[c+2],9,-51403784),i=s(i,f,r,n,t[c+7],14,1735328473),n=s(n,i,f,r,t[c+12],20,-1926607734),r=a(r,n,i,f,t[c+5],4,-378558),f=a(f,r,n,i,t[c+8],11,-2022574463),i=a(i,f,r,n,t[c+11],16,1839030562),n=a(n,i,f,r,t[c+14],23,-35309556),r=a(r,n,i,f,t[c+1],4,-1530992060),f=a(f,r,n,i,t[c+4],11,1272893353),i=a(i,f,r,n,t[c+7],16,-155497632),n=a(n,i,f,r,t[c+10],23,-1094730640),r=a(r,n,i,f,t[c+13],4,681279174),f=a(f,r,n,i,t[c+0],11,-358537222),i=a(i,f,r,n,t[c+3],16,-722521979),n=a(n,i,f,r,t[c+6],23,76029189),r=a(r,n,i,f,t[c+9],4,-640364487),f=a(f,r,n,i,t[c+12],11,-421815835),i=a(i,f,r,n,t[c+15],16,530742520),n=a(n,i,f,r,t[c+2],23,-995338651),r=u(r,n,i,f,t[c+0],6,-198630844),f=u(f,r,n,i,t[c+7],10,1126891415),i=u(i,f,r,n,t[c+14],15,-1416354905),n=u(n,i,f,r,t[c+5],21,-57434055),r=u(r,n,i,f,t[c+12],6,1700485571),f=u(f,r,n,i,t[c+3],10,-1894986606),i=u(i,f,r,n,t[c+10],15,-1051523),n=u(n,i,f,r,t[c+1],21,-2054922799),r=u(r,n,i,f,t[c+8],6,1873313359),f=u(f,r,n,i,t[c+15],10,-30611744),i=u(i,f,r,n,t[c+6],15,-1560198380),n=u(n,i,f,r,t[c+13],21,1309151649),r=u(r,n,i,f,t[c+4],6,-145523070),f=u(f,r,n,i,t[c+11],10,-1120210379),i=u(i,f,r,n,t[c+2],15,718787259),n=u(n,i,f,r,t[c+9],21,-343485551),r=h(r,l),n=h(n,p),i=h(i,d),f=h(f,v)}return Array(r,n,i,f)}function i(t,e,r,n,i,o){return h(f(h(h(e,t),h(n,o)),i),r)}function o(t,e,r,n,o,s,a){return i(e&r|~e&n,t,e,o,s,a)}function s(t,e,r,n,o,s,a){return i(e&n|r&~n,t,e,o,s,a)}function a(t,e,r,n,o,s,a){return i(e^r^n,t,e,o,s,a)}function u(t,e,r,n,o,s,a){return i(r^(e|~n),t,e,o,s,a)}function h(t,e){var r=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(r>>16)<<16|65535&r}function f(t,e){return t<<e|t>>>32-e}var c=t("./helpers");e.exports=function(t){return c.hash(t,n,16)}},{"./helpers":11}],13:[function(t,e,r){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function o(t){return"number"==typeof t}function s(t){return"object"==typeof t&&null!==t}function a(t){return void 0===t}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!o(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,r,n,o,u,h;if(this._events||(this._events={}),"error"===t&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var f=new Error('Uncaught, unspecified "error" event. ('+e+")");throw f.context=e,f}if(r=this._events[t],a(r))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),r.apply(this,o)}else if(s(r))for(o=Array.prototype.slice.call(arguments,1),h=r.slice(),n=h.length,u=0;u<n;u++)h[u].apply(this,o);return!0},n.prototype.addListener=function(t,e){var r;if(!i(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(e.listener)?e.listener:e),this._events[t]?s(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,s(this._events[t])&&!this._events[t].warned&&(r=a(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[t].length>r&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){function r(){this.removeListener(t,r),n||(n=!0,e.apply(this,arguments))}if(!i(e))throw TypeError("listener must be a function");var n=!1;return r.listener=e,this.on(t,r),this},n.prototype.removeListener=function(t,e){var r,n,o,a;if(!i(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(r=this._events[t],o=r.length,n=-1,r===e||i(r.listener)&&r.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(s(r)){for(a=o;a-- >0;)if(r[a]===e||r[a].listener&&r[a].listener===e){n=a;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[t]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[t],i(r))this.removeListener(t,r);else if(r)for(;r.length;)this.removeListener(t,r[r.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){return this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(i(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},{}],14:[function(t,e,r){r.read=function(t,e,r,n,i){var o,s,a=8*i-n-1,u=(1<<a)-1,h=u>>1,f=-7,c=r?i-1:0,l=r?-1:1,p=t[e+c];for(c+=l,o=p&(1<<-f)-1,p>>=-f,f+=a;f>0;o=256*o+t[e+c],c+=l,f-=8);for(s=o&(1<<-f)-1,o>>=-f,f+=n;f>0;s=256*s+t[e+c],c+=l,f-=8);if(0===o)o=1-h;else{if(o===u)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),o-=h}return(p?-1:1)*s*Math.pow(2,o-n)},r.write=function(t,e,r,n,i,o){var s,a,u,h=8*o-i-1,f=(1<<h)-1,c=f>>1,l=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,d=n?1:-1,v=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=f):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),e+=s+c>=1?l/u:l*Math.pow(2,1-c),e*u>=2&&(s++,u/=2),s+c>=f?(a=0,s=f):s+c>=1?(a=(e*u-1)*Math.pow(2,i),s+=c):(a=e*Math.pow(2,c-1)*Math.pow(2,i),s=0));i>=8;t[r+p]=255&a,p+=d,a/=256,i-=8);for(s=s<<i|a,h+=i;h>0;t[r+p]=255&s,p+=d,s/=256,h-=8);t[r+p-d]|=128*v}},{}],15:[function(t,e,r){(function(t){"use strict";function r(){f=!0;for(var t,e,r=c.length;r;){for(e=c,c=[],t=-1;++t<r;)e[t]();r=c.length}f=!1}function n(t){1!==c.push(t)||f||i()}var i,o=t.MutationObserver||t.WebKitMutationObserver;if(o){var s=0,a=new o(r),u=t.document.createTextNode("");a.observe(u,{characterData:!0}),i=function(){u.data=s=++s%2}}else if(t.setImmediate||void 0===t.MessageChannel)i="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){r(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(r,0)};else{var h=new t.MessageChannel;h.port1.onmessage=r,i=function(){h.port2.postMessage(0)}}var f,c=[];e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],16:[function(t,e,r){var n={}.toString;e.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},{}],17:[function(t,e,r){"use strict";function n(){}function i(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=g,this.queue=[],this.outcome=void 0,t!==n&&u(this,t)}function o(t,e,r){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function s(t,e,r){d(function(){var n;try{n=e(r)}catch(e){return v.reject(t,e)}n===t?v.reject(t,new TypeError("Cannot resolve promise with itself")):v.resolve(t,n)})}function a(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function u(t,e){function r(e){o||(o=!0,v.reject(t,e))}function n(e){o||(o=!0,v.resolve(t,e))}function i(){e(n,r)}var o=!1,s=h(i);"error"===s.status&&r(s.value)}function h(t,e){var r={};try{r.value=t(e),r.status="success"}catch(t){r.status="error",r.value=t}return r}function f(t){return t instanceof this?t:v.resolve(new this(n),t)}function c(t){var e=new this(n);return v.reject(e,t)}function l(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var r=t.length,i=!1;if(!r)return this.resolve([]);for(var o=new Array(r),s=0,a=-1,u=new this(n);++a<r;)!function(t,n){function a(t){o[n]=t,++s!==r||i||(i=!0,v.resolve(u,o))}e.resolve(t).then(a,function(t){i||(i=!0,v.reject(u,t))})}(t[a],a);return u}function p(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var r=t.length,i=!1;if(!r)return this.resolve([]);for(var o=-1,s=new this(n);++o<r;)!function(t){e.resolve(t).then(function(t){i||(i=!0,v.resolve(s,t))},function(t){i||(i=!0,v.reject(s,t))})}(t[o]);return s}var d=t("immediate"),v={},y=["REJECTED"],m=["FULFILLED"],g=["PENDING"];e.exports=i,i.prototype.finally=function(t){function e(e){function r(){return e}return n.resolve(t()).then(r)}function r(e){function r(){throw e}return n.resolve(t()).then(r)}if("function"!=typeof t)return this;var n=this.constructor;return this.then(e,r)},i.prototype.catch=function(t){return this.then(null,t)},i.prototype.then=function(t,e){if("function"!=typeof t&&this.state===m||"function"!=typeof e&&this.state===y)return this;var r=new this.constructor(n);if(this.state!==g){s(r,this.state===m?t:e,this.outcome)}else this.queue.push(new o(r,t,e));return r},o.prototype.callFulfilled=function(t){v.resolve(this.promise,t)},o.prototype.otherCallFulfilled=function(t){s(this.promise,this.onFulfilled,t)},o.prototype.callRejected=function(t){v.reject(this.promise,t)},o.prototype.otherCallRejected=function(t){s(this.promise,this.onRejected,t)},v.resolve=function(t,e){var r=h(a,e);if("error"===r.status)return v.reject(t,r.value);var n=r.value;if(n)u(t,n);else{t.state=m,t.outcome=e;for(var i=-1,o=t.queue.length;++i<o;)t.queue[i].callFulfilled(e)}return t},v.reject=function(t,e){t.state=y,t.outcome=e;for(var r=-1,n=t.queue.length;++r<n;)t.queue[r].callRejected(e);return t},i.resolve=f,i.reject=c,i.all=l,i.race=p},{immediate:15}],18:[function(t,e,r){"use strict";function n(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.exports=function(t,e,r,o){e=e||"&",r=r||"=";var s={};if("string"!=typeof t||0===t.length)return s;var a=/\+/g;t=t.split(e);var u=1e3;o&&"number"==typeof o.maxKeys&&(u=o.maxKeys);var h=t.length;u>0&&h>u&&(h=u);for(var f=0;f<h;++f){var c,l,p,d,v=t[f].replace(a,"%20"),y=v.indexOf(r);y>=0?(c=v.substr(0,y),l=v.substr(y+1)):(c=v,l=""),p=decodeURIComponent(c),d=decodeURIComponent(l),n(s,p)?i(s[p])?s[p].push(d):s[p]=[s[p],d]:s[p]=d}return s};var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{}],19:[function(t,e,r){"use strict";function n(t,e){if(t.map)return t.map(e);for(var r=[],n=0;n<t.length;n++)r.push(e(t[n],n));return r}var i=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};e.exports=function(t,e,r,a){return e=e||"&",r=r||"=",null===t&&(t=void 0),"object"==typeof t?n(s(t),function(s){var a=encodeURIComponent(i(s))+r;return o(t[s])?n(t[s],function(t){return a+encodeURIComponent(i(t))}).join(e):a+encodeURIComponent(i(t[s]))}).join(e):a?encodeURIComponent(i(a))+r+encodeURIComponent(i(t)):""};var o=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},s=Object.keys||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.push(r);return e}},{}],20:[function(t,e,r){"use strict";r.decode=r.parse=t("./decode"),r.encode=r.stringify=t("./encode")},{"./decode":18,"./encode":19}],21:[function(t,e,r){var n=function(){function t(t){if(t=t||{},this.size=t.size||256,!e[this.size]){var r=this.size,n=e[this.size]={};n.Bc=[],n.Cc=[],n.zc=[],n.Ac=[];for(var i=0;i<30;i++)n.Bc.push(r/360),n.Cc.push(r/(2*Math.PI)),n.zc.push(r/2),n.Ac.push(r),r*=2}this.Bc=e[this.size].Bc,this.Cc=e[this.size].Cc,this.zc=e[this.size].zc,this.Ac=e[this.size].Ac}var e={},r=Math.PI/180,n=180/Math.PI,i=6378137,o=20037508.342789244;return t.prototype.px=function(t,e){var n=this.zc[e],i=Math.min(Math.max(Math.sin(r*t[1]),-.9999),.9999),o=Math.round(n+t[0]*this.Bc[e]),s=Math.round(n+.5*Math.log((1+i)/(1-i))*-this.Cc[e]);return o>this.Ac[e]&&(o=this.Ac[e]),s>this.Ac[e]&&(s=this.Ac[e]),[o,s]},t.prototype.ll=function(t,e){var r=(t[1]-this.zc[e])/-this.Cc[e];return[(t[0]-this.zc[e])/this.Bc[e],n*(2*Math.atan(Math.exp(r))-.5*Math.PI)]},t.prototype.bbox=function(t,e,r,n,i){n&&(e=Math.pow(2,r)-1-e);var o=[t*this.size,(+e+1)*this.size],s=[(+t+1)*this.size,e*this.size],a=this.ll(o,r).concat(this.ll(s,r));return"900913"===i?this.convert(a,"900913"):a},t.prototype.xyz=function(t,e,r,n){"900913"===n&&(t=this.convert(t,"WGS84"));var i=[t[0],t[1]],o=[t[2],t[3]],s=this.px(i,e),a=this.px(o,e),u=[Math.floor(s[0]/this.size),Math.floor((a[0]-1)/this.size)],h=[Math.floor(a[1]/this.size),Math.floor((s[1]-1)/this.size)],f={minX:Math.min.apply(Math,u)<0?0:Math.min.apply(Math,u),minY:Math.min.apply(Math,h)<0?0:Math.min.apply(Math,h),maxX:Math.max.apply(Math,u),maxY:Math.max.apply(Math,h)};if(r){var c={minY:Math.pow(2,e)-1-f.maxY,maxY:Math.pow(2,e)-1-f.minY};f.minY=c.minY,f.maxY=c.maxY}return f},t.prototype.convert=function(t,e){return"900913"===e?this.forward(t.slice(0,2)).concat(this.forward(t.slice(2,4))):this.inverse(t.slice(0,2)).concat(this.inverse(t.slice(2,4)))},t.prototype.forward=function(t){var e=[i*t[0]*r,i*Math.log(Math.tan(.25*Math.PI+.5*t[1]*r))];return e[0]>o&&(e[0]=o),e[0]<-o&&(e[0]=-o),e[1]>o&&(e[1]=o),e[1]<-o&&(e[1]=-o),e},t.prototype.inverse=function(t){return[t[0]*n/i,(.5*Math.PI-2*Math.atan(Math.exp(-t[1]/i)))*n]},t}();void 0!==e&&void 0!==r&&(e.exports=r=n)},{}],22:[function(t,e,r){"use strict";function n(t,e,r){return new i(function(n,i){function a(){if(f.status>299)i(new Error(f.response||f.status));else{if("json"===f.responseType)return n(f.response);try{n(JSON.parse(f.response))}catch(t){n(f.response)}}f.removeEventListener("load",a,!1),f.removeEventListener("error",u,!1)}function u(t){f.removeEventListener("load",a,!1),f.removeEventListener("error",u,!1),i(t)}"string"==typeof e&&-1!==s.indexOf(e.toUpperCase())||void 0!==r||(r=e||{},e="GET");var h=o.stringify(r);"get"===(e=e.toLowerCase())&&h&&(t=t+"?"+h);var f=new XMLHttpRequest;f.open(e,t,!0);try{f.responseType="json"}catch(t){}f.addEventListener("error",i,!1),f.addEventListener("load",a,!1),"get"===e?f.send():(f.setRequestHeader("content-type","application/x-www-form-urlencoded"),f.send(h))})}var i=t("lie"),o=t("querystring"),s=["CHECKOUT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCALENDAR","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","UNLOCK","UNSUBSCRIBE"];e.exports=n},{lie:17,querystring:20}],23:[function(t,e,r){"use strict";var n=t("./ajax");e.exports=n,n.get=n,n.post=function(t,e){return n(t,"post",e)}},{"./ajax":22}],24:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){return u(t)||a(t,e)||s()}function s(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function a(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(i)throw o}}return r}function u(t){if(Array.isArray(t))return t}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function c(t,e,r){return e&&f(t.prototype,e),r&&f(t,r),t}function l(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?p(t):e}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function v(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&y(t,e)}function y(t,e){return(y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var m=n(t("./google")),g=n(t("events")),w=n(t("./poll")),_=n(t("querystring")),b=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,r):{};n.get||n.set?Object.defineProperty(e,r,n):e[r]=t[r]}return e.default=t,e}(t("./get-layer-hash")),E=n(t("./image-map")),A=n(t("zoku")),x=n(t("./utfgrid")),L=n(t("sphericalmercator")),P=n(t("./replace-img")),M=n(t("./sort-layers")),T=n(t("./process-ml-data")),I=new L.default,O=function(t,e){return Math.abs(6371009*Math.cos(t/180)/Math.pow(2,e+4))},R="https://maps.gstatic.com/mapfiles/transparent.png",C=Promise.resolve(R),S=function(t){function e(t){var r;h(this,e),r=l(this,d(e).call(this)),r.account=t.account;var n=r.table=t.table;r.host=t.host;var i=t.type;i||(n.length>4&&"Line"===n.slice(-4)?i="line":n.length>5&&"Point"===n.slice(-5)&&(i="point"));var o=-1;return"number"==typeof t.zindex&&(o=t.zindex),r._zindex=o,r.name=t.name||"unk"+Math.random(),r.minZoom=t.minZoom||0,r.maxZoom=t.maxZoom||20,r.utfGrid=null,r.subdomains=t.subdomains||!1,r.click=t.click,r.type=i,r.rules=t.rules,r.watching=null,r.map=null,r.fields=t.fields||[],r.refreshRate=t.refresh,r._sort=t.sort,r.tileLayer=null,r.cache=new Map,r._index=null,r._verificationCache=new Map,r.limit=500,r.hashCache=new Map,r.divCache=new Map,r._tableName="".concat(r.account,"/").concat(r.table),r.specialQuery=[],r.knownHashes=new Set,r.waitingImages=new Map,r._fullTable=null,r._zooming=!1,r.zoomlisteners=null,r._removed=!1,r._getready(),r}return v(e,t),c(e,[{key:"_getready",value:function(){var t,e=this;this.ready=new Promise(function(e){return t=e}),this._changeFun=function(r){var n=!e._fullTable;e._fullTable=r,e._tableName=r,e.emit("fullTable",r),e.refreshTiles(n),t()},this.on("change",this._changeFun),this.refreshRate&&this.watch()}},{key:"putIntoOverlayMapTypes",value:function(){this.map&&this.tileLayer&&(this.map.overlayMapTypes.indexOf(this.tileLayer)>-1||(this.hashCache=new Map,null!==this._index&&this._index<this.map.overlayMapTypes.getLength()?this.map.overlayMapTypes.insertAt(this._index,this.tileLayer):(this.map.overlayMapTypes.push(this.tileLayer),this._index=this.map.overlayMapTypes.indexOf(this.tileLayer)),(0,M.default)(this.map)))}},{key:"removeFromOverlayMapTypes",value:function(){if(this.map&&this.tileLayer){for(var t=this._index=this.map.overlayMapTypes.indexOf(this.tileLayer);t>-1;)this.map.overlayMapTypes.removeAt(t),t=this.map.overlayMapTypes.indexOf(this.tileLayer);this.hashCache=new Map,this.tileLayer.destroy(),this.divCache=new Map,this.tileLayer=null}}},{key:"getRules",value:function(t){var e=this._getRules(t);return e?Array.isArray(e)?e.map(this.addQuery,this):this.addQuery(e):e}},{key:"addQuery",value:function(t){var e={};return Object.keys(t).forEach(function(r){e[r]=t[r]}),e.query=e.query||[],e.query=e.query.concat(this.specialQuery),e}},{key:"_getRules",value:function(t){if(!this.rules)return!1;if(this.rules.simple)return this.rules;if(!0===t)return this.rules.styles;if("number"==typeof t){var e=t;return this.rules.styles.find(function(t){return e>=t.range[0]&&e<=t.range[1]})}}},{key:"getLayerJson",value:function(t,e,r){var n=[];t=t||this.getRules(e);var i=this.type;t.type&&(i=t.type),r?n=r:t.query&&(n=t.query),t.rules&&(t=t.rules);var o={layer:{style:{method:"rules"},query:{select:{},table:{name:this._tableName}}}};switch(t&&(o.layer.style.rules=t),o.layer.query.where=n,i){case"line":o.layer.query.select.type="geo.line";break;case"point":o.layer.query.select.type="geo.dot"}return this._sort&&(o.layer.style.orderBy=this._sort),o}},{key:"getLayerHash",value:function(t){if(this.cache.has(t))return this.cache.get(t);var e=(0,b.default)(t);return this.cache.set(t,e),e}},{key:"getTileUrl",value:function(t,e,r){var n=this;return t<this.minZoom||t>this.maxZoom?C:this.getHash(t).then(function(i){return"https://".concat(n.getSubdomain(e,r)).concat(n.host,"/Api/ProcessRequest?hash=").concat(i,"&uParams=x:").concat(e,";y:").concat(r,";z:").concat(t,";action:tile%2Fgettile")})}},{key:"getSubdomain",value:function(t,e){if(!1===this.subdomains)return"";var r=t+e;return r<0&&(r=-r),r%this.subdomains}},{key:"watch",value:function(){if(!this.watching){var t={account:this.account,host:this.host,table:this.table},e=new w.default(t,this.refreshRate),r=this;e.on("change",function(t){r.emit("change",t)}),this.watching=e}}},{key:"stopWatching",value:function(){var t=this.watching;if(!t)throw new Error("no such watcher");this.watching=null,t.abort()}},{key:"getClickBox",value:function(t,e,r){r+=4;var n=1<<r,i=this.map.getProjection(),o=i.fromLatLngToPoint(new m.default.maps.LatLng(t,e)),s=new m.default.maps.Point(o.x*n,o.y*n),a=new m.default.maps.Point(Math.floor(s.x/256),Math.floor(s.y/256));return I.bbox(a.x,a.y,r)}},{key:"getInfo",value:function(t,e,r){var n=this;if(!this.map)return Promise.reject(new Error("map not loaded"));if(!this._fullTable)return new Promise(function(i){return n.on("fullTable",function(){return i(n.getInfo(t,e,r))})});var i=this.getClickBox(t,e,r),o=O(t,r-1),s={col:"point"===this.type?"XY":this.table,test:"DWithin:".concat(~~o),value:"WKT(POLYGON(".concat(i[0]," ").concat(i[1],",").concat(i[2]," ").concat(i[1],",").concat(i[2]," ").concat(i[3],",").concat(i[0]," ").concat(i[3],",").concat(i[0]," ").concat(i[1],")),COL(").concat("point"===this.type?"XY":this.table,")")},a=this.getRules(r);a=a&&a.query||[],a=a.slice(),a.push(s);var u={action:"table/query",query:{sqlselect:this.fields,start:0,table:this._fullTable,take:this.limit,where:a}};return this.query(u)}},{key:"getFields",value:function(t){var e={action:"table/query",query:{sqlselect:["".concat(t,".count"),t],groupby:[t],start:0,table:this._fullTable,take:this.limit,where:[]}};return this.query(e)}},{key:"query",value:function(t){var e=this,r=_.default.stringify({request:JSON.stringify(t)}),n="https://".concat(this.host,"/Api/ProcessDirect?").concat(r);return(0,A.default)(n).then(function(t){return e.transposeResp(t)})}},{key:"updateQuery",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.specialQuery=t,this.refreshTiles()}},{key:"transposeResp",value:function(t){if(!t.success){if(t.errors.length)throw t.errors;throw new Error("not found")}var e=t.data.data,r=Object.keys(e),n=r.reduce(function(t,r){return Math.min(t,e[r].length)},1/0);if(n===1/0)return[];for(var i,o,s=new Array(n),a=-1;++a<n;)for(i=s[a]={},o=-1;++o<r.length;)i[r[o]]=e[r[o]][a];return s}},{key:"subdomainFromHash",value:function(t){return this.subdomains?parseInt(t.slice(-8),16)%this.subdomains:""}},{key:"checkRegistration",value:function(t,e){var r=this;if(this.knownHashes.has(e))return Promise.resolve(!0);if(this._verificationCache.has(e))return this._verificationCache.get(e);var n="https://".concat(this.subdomainFromHash(e)).concat(this.host,"/Api/VerifyRequest"),i={hash:e},o=(0,A.default)(n,i).then(function(e){return!!e.isCached||r.cacheRequest({request:(0,b.stringify)(t)})}).then(function(t){return r._verificationCache.delete(e),r.knownHashes.add(e),t},function(t){throw r._verificationCache.delete(e),t});return this._verificationCache.set(e,o),o}},{key:"getHash",value:function(t){var e=this;if(!this._fullTable)return this.ready.then(function(){return e.getHash(t)});if(this.hashCache.has(t))return Promise.resolve(this.hashCache.get(t));var r=this.hashCache,n=this.getLayerJson(!1,t),i=this.getLayerHash(n);return this.knownHashes.has(i)?(r.set(t,i),Promise.resolve(i)):this.checkRegistration(n,i).then(function(){return r.set(t,i),i})}},{key:"getGrid",value:function(){var t=this;return new x.default(function(e,r,n){return e<t.minZoom||e>t.maxZoom?Promise.resolve(!1):t.getHash(e).then(function(i){return["https://".concat(t.getSubdomain(r,n)).concat(t.host,"/Api/ProcessRequest"),{hash:i,uParams:"x:".concat(r,";y:").concat(n,";z:").concat(e,";label:").concat(t.fields.join(","),";action:tile/hovergrid")}]})},{zindex:this._zindex,minZoom:this.minZoom,maxZoom:this.maxZoom})}},{key:"getMap",value:function(){if(this.map)return this.map}},{key:"setMap",value:function(t){if(t!==this.map)return t?this.addTo(t):void this.removeFromMap()}},{key:"removeFromMap",value:function(){this.removeListener("change",this._changeFun),this.zoomlisteners&&(this.zoomlisteners.map(function(t){return t.remove()}),this.zoomlisteners=null),this.watching&&this.stopWatching(),this.utfGrid&&this.utfGrid.setMap(null),this.tileLayer&&this.removeFromOverlayMapTypes(),this.cache.clear(),this.map=null,this._fullTable=null,this._removed=!0}},{key:"refreshTiles",value:function(t){this.hashCache=new Map,this.cache.clear(),this.tileLayer&&this.map&&this._replaceImages(t)}},{key:"replaceImg",value:function(t,e){return!!this.divCache.has(e)&&(this._zooming?this.waitingImages.set(e,t):(0,P.default)(t,e),!0)}},{key:"_replaceImages",value:function(){var t=this;this.utfGrid&&this.utfGrid.reset();var e=!0,r=!1,n=void 0;try{for(var i,s=this.divCache[Symbol.iterator]();!(e=(i=s.next()).done);e=!0){var a=o(i.value,2),u=a[0],h=a[1],f=h.zoom,c=h.coord;this.replaceImg(R,u),this.getTileUrl(f,c.x,c.y).then(function(e,r,n){return function(i){t.replaceImg(i,e)&&t.utfGrid&&t.utfGrid._loadTile(r,n.x,n.y)}}(u,f,c))}}catch(t){r=!0,n=t}finally{try{e||null==s.return||s.return()}finally{if(r)throw n}}}},{key:"_drainReplaceImg",value:function(){var t=!0,e=!1,r=void 0;try{for(var n,i=this.waitingImages[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var s=o(n.value,2),a=s[0],u=s[1];if(this.waitingImages.delete(a),!this.divCache.has(a))return!1;(0,P.default)(u,a)}}catch(t){e=!0,r=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw r}}}},{key:"addTo",value:function(t){var e=this;this.map=t,this.hashCache=new Map,this.cache.clear(),this._removed&&(this._removed=!1,this._getready()),this.zoomlisteners&&this.zoomlisteners.map(function(t){return t.remove()}),this.zoomlisteners=[m.default.maps.event.addListener(t,"zoom_changed",function(){e._zooming=!0,e.emit("zoom-started")}),m.default.maps.event.addListener(t,"idle",function(){e._zooming=!1,e._drainReplaceImg(),e.emit("zoom-ended")})],this.tileLayer||(this.tileLayer=new E.default(this)),this.putIntoOverlayMapTypes(),this.makeUtf()}
},{key:"makeUtf",value:function(){var t=this;"function"==typeof this.click&&(this.utfGrid||(this.utfGrid=this.getGrid(),this.name&&(this.utfGrid.name=this.name)),this.utfGrid.on("click",function(e){t.click({latLng:e.latLng,data:(0,T.default)(t.fields,e.data)})}),this.utfGrid.setMap(this.map))}},{key:"cacheRequest",value:function(t,e){e=e||"CacheRequest";var r="https://".concat(this.host,"/Api/").concat(e,"?aInfo=mluser:null;mltoken:null");return(0,A.default)(r,"POST",t).then(function(t){if(!t.success)throw t;return t})}}]),e}(g.default.EventEmitter);r.default=S,e.exports=r.default},{"./get-layer-hash":1,"./google":2,"./image-map":3,"./poll":4,"./process-ml-data":5,"./replace-img":6,"./sort-layers":7,"./utfgrid":8,events:13,querystring:20,sphericalmercator:21,zoku:23}]},{},[24])(24)});
